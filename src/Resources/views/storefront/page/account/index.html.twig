{% sw_extends '@Storefront/storefront/page/account/index.html.twig' %}

{% block page_account_main_content %}
    {{ parent() }}
    {% if page.header.extensions.sg_connect_data %}
        <script type="text/javascript">
            function initPipelineCall() {
                window.SGAppConnector.sendPipelineRequest(
                    'shopgate.user.loginUser.v1',
                    true,
                    {
                        'strategy': 'auth_code',
                        'parameters': {'token': '{{ app.request.attributes.get('sw-sales-channel-context').token }}'}
                    },
                    function () {
                        window.SGAppConnector.sendAppCommands([
                            {
                                'c': 'broadcastEvent',
                                'p': {'event': 'userLoggedIn'}
                            },
                            {
                                'c': 'broadcastEvent',
                                'p': {'event': 'closeNotification'}
                            },
                            {
                                'c': 'broadcastEvent',
                                'p': {'event': 'closeInAppBrowser', 'parameters': [{'redirectTo': '/'}]}
                            }
                        ]);
                    }
                );
            }
        </script>
    {% endif %}
{% endblock %}
