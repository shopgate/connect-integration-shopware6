(window.webpackJsonp=window.webpackJsonp||[]).push([["shopgate-connect-s-w6"],{leSB:function(e,n,t){"use strict";t.r(n);var o=t("FGIj");function r(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}var a=function(){function e(n){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),i(this,"active",!0),i(this,"pluginName","Shopgate Connect Plugin"),i(this,"isDev",!1),this.isDev=n}var n,t,o;return n=e,(t=[{key:"supports",value:function(e,n){return console.warn("[".concat(this.pluginName,"] Method 'supports' was not overridden by \"")+this.constructor.name+'". Default return set to false.'),!1}},{key:"execute",value:function(){console.warn("[".concat(this.pluginName,"] Method 'execute' was not overridden by \"")+this.constructor.name+'".')}},{key:"disable",value:function(){this.active=!1}},{key:"log",value:function(e){this.isDev&&console.warn(this.pluginName+": "+e)}}])&&r(n.prototype,t),o&&r(n,o),e}();function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function s(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function l(e,n){return!n||"object"!==c(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):n}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,n){return(f=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}var y=function(e){function n(){return u(this,n),l(this,p(n).apply(this,arguments))}var t,o,r;return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&f(e,n)}(n,e),t=n,(o=[{key:"supports",value:function(e,n){return"checkout"===e&&"finishpage"===n}},{key:"execute",value:function(e){e||this.log("Checkout success, but order parameters are empty"),window.SGAppConnector.sendAppCommands([{c:"broadcastEvent",p:{event:"checkoutSuccess",parameters:e}},{c:"setNavigationBarParams",p:{navigationBarParams:{leftButton:!0,leftButtonType:"close",leftButtonCallback:"SGAction.broadcastEvent({event: 'closeInAppBrowser','parameters': [{'redirectTo': '/'}]});"}}}])}}])&&s(t.prototype,o),r&&s(t,r),n}(a);function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function d(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function h(e,n){return!n||"object"!==v(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):n}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,n){return(g=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}var w=function(e){function n(){return b(this,n),h(this,m(n).apply(this,arguments))}var t,o,r;return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&g(e,n)}(n,e),t=n,(o=[{key:"supports",value:function(e,n){return"accountprofile"===e&&"index"===n||"sgconnect"===e&&"registered"===n}},{key:"execute",value:function(e){e||this.log("Login success, but no context token is passed from twig template"),window.SGAppConnector.sendPipelineRequest("shopgate.user.loginUser.v1",!0,{strategy:"auth_code",parameters:{code:e.token}},(function(){window.SGAppConnector.sendAppCommands([{c:"broadcastEvent",p:{event:"userLoggedIn"}}])}),[])}}])&&d(t.prototype,o),r&&d(t,r),n}(a);function S(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var O=function(){function e(n,t,o,r){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.controllerName=n,this.actionName=t,this.properties=o,this.isDev="dev"===r,this.events=[]}var n,t,o;return n=e,(t=[{key:"registerDefaultEvents",value:function(){this.registerEvent(y),this.registerEvent(w)}},{key:"registerEvent",value:function(e){this.events.push(new e(this.isDev))}},{key:"executeEvents",value:function(){var e=this;this.events.forEach((function(n){n.supports(e.controllerName,e.actionName)&&n.active&&(n.log("Executing event > "+n.constructor.name),n.execute(e.properties))}))}},{key:"disableEvents",value:function(){this.events.forEach((function(e){e.disable()}))}}])&&S(n.prototype,t),o&&S(n,o),e}();function k(e){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function E(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function P(e,n){return!n||"object"!==k(n)&&"function"!=typeof n?j(e):n}function C(e){return(C=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function j(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function A(e,n){return(A=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}function G(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}var x=function(e){function n(){var e,t;E(this,n);for(var o=arguments.length,r=new Array(o),i=0;i<o;i++)r[i]=arguments[i];return G(j(t=P(this,(e=C(n)).call.apply(e,[this].concat(r)))),"options",{controllerName:null,actionName:null,properties:null,env:null}),t}var t,o,r;return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&A(e,n)}(n,e),t=n,(o=[{key:"init",value:function(){var e=this.options,n=e.controllerName,t=e.actionName,o=e.properties,r=e.env;this.eventManager=new O(n,t,o,r),this.initSGBridge(),this.executeWithRetry(40,3e3,this.initShopgateApp.bind(this))}},{key:"executeWithRetry",value:function(e,n,t){var o=Date.now();if(!t())var r=setInterval((function(){(o+n<=Date.now()||t())&&clearInterval(r)}),e)}},{key:"initShopgateApp",value:function(){return!!window.SGJavascriptBridge&&(this.eventManager.registerDefaultEvents(),this.eventManager.executeEvents(),setTimeout((function(){window.SGAppConnector.closeLoadingSpinner()}),3e3),!0)}},{key:"initSGBridge",value:function(){window.SGAppConnector={pipelineResponseHandler:{},functionExists:function(e){return"function"==typeof e},sendAppCommands:function(e){var n="12.0";"dispatchCommandsForVersion"in window.SGJavascriptBridge?window.SGJavascriptBridge.dispatchCommandsForVersion(e,n):window.SGJavascriptBridge.dispatchCommandsStringForVersion(JSON.stringify(e),n)},sendAppCommand:function(e){this.sendAppCommands([e])},closeLoadingSpinner:function(){this.sendAppCommand({c:"onload"})},sendPipelineRequest:function(e,n,t,o,r){t||(t={}),r||(r=null);var i={c:"sendPipelineRequest",p:{serial:e,name:e,input:t}};n&&(i.p.type="trusted"),this.pipelineResponseHandler[e]={callbackParams:r,__call:function(n,t,r){if(window.SGAppConnector.functionExists(o))return console.log("## running response callback for pipeline call: "+e),o(n,t,r);console.log("## no callback registered for pipeline call: "+e)}},this.sendAppCommand(i)}},window.SGEvent={__call:function(e,n){console.log("# Received event "+e),n&&Array.isArray(n)||(n=[]),SGEvent[e]&&SGEvent[e].apply(SGEvent,n)},pipelineResponse:function(e,n,t){if(e&&console.error("Called pipeline '"+n+"' resulted in an error: "+JSON.stringify(e)),window.SGAppConnector.pipelineResponseHandler[n]){var o=window.SGAppConnector.pipelineResponseHandler[n];return o.__call(e,t,o.callbackParams)}},isDocumentReady:function(){return!0}}}}])&&_(t.prototype,o),r&&_(t,r),n}(o.a);window.PluginManager.register("SgConnectAppPlugin",x,"[data-sg-connect-app-plugin]")}},[["leSB","runtime","vendor-node","vendor-shared"]]]);